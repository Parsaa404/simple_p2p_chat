# Peer-to-Peer Anonymous Messenger (P2P-AnonChat)

این یک پیام‌رسان ساده و ناشناس نظیر به نظیر (P2P) است که با استفاده از پایتون ساخته شده است.
این برنامه به کاربران اجازه می‌دهد تا پیام‌های رمزنگاری شده را مستقیماً و بدون نیاز به سرور مرکزی، ثبت‌نام، یا ارائه اطلاعات شخصی ارسال و دریافت کنند.

## ویژگی‌ها

*   **ارتباط نظیر به نظیر (P2P):** پیام‌ها مستقیماً بین کاربران ارسال می‌شوند.
*   **بدون سرور مرکزی:** نیازی به اعتماد به یک سرور واسط نیست.
*   **بدون ثبت‌نام:** برای استفاده از برنامه نیازی به ایجاد حساب کاربری، شماره تلفن یا ایمیل نیست.
*   **ناشناس (نسبی):** برنامه هیچ اطلاعات شناسایی از کاربر (مانند موقعیت مکانی، مخاطبین) را ذخیره یا درخواست نمی‌کند. البته IP فرستنده برای گیرنده قابل مشاهده است که از ویژگی‌های ارتباط P2P می‌باشد.
*   **رمزنگاری سرتاسری:** پیام‌ها با استفاده از یک کلید از پیش اشتراک گذاشته شده (PSK) با استفاده از الگوریتم Fernet (بخشی از کتابخانه `cryptography` پایتون) رمزنگاری می‌شوند.
*   **رابط کاربری خط فرمان (CLI):** ساده و آسان برای استفاده.

## پیش‌نیازها

*   پایتون 3.x
*   کتابخانه `cryptography` پایتون.

## نصب

1.  پروژه را کلون کنید یا فایل‌های `main.py`, `network.py`, و `crypto.py` را دانلود کنید.
2.  کتابخانه `cryptography` را نصب کنید:
    ```bash
    pip install cryptography
    ```

## نحوه استفاده

1.  **اجرای برنامه:**
    هر دو کاربر باید برنامه را اجرا کنند:
    ```bash
    python main.py
    ```
2.  **وارد کردن پورت:**
    در ابتدای اجرا، برنامه از شما می‌خواهد که یک پورت برای گوش دادن به پیام‌های ورودی وارد کنید (مثلاً `12345`). این پورت باید در شبکه شما آزاد باشد (معمولاً بین 1024 و 65535).
    آدرس شما به صورت `YOUR_IP:YOUR_PORT` نمایش داده خواهد شد. (برای تست در یک کامپیوتر از `127.0.0.1` به عنوان IP استفاده کنید. در شبکه محلی، IP داخلی شما نمایش داده می‌شود).

3.  **اشتراک‌گذاری کلید (بسیار مهم):**
    *   برنامه از یک کلید از پیش اشتراک گذاشته شده (PSK) استفاده می‌کند که در فایل `crypto.py` در متغیر `PRE_SHARED_KEY` تعریف شده است.
    *   **برای ارتباط امن، هر دو کاربر باید دقیقاً از یک کلید یکسان استفاده کنند.**
    *   برای اولین بار استفاده یا برای امنیت بیشتر، یک کاربر می‌تواند با تایپ `newkey` در برنامه، یک کلید جدید تولید کند. این کلید جدید (یک رشته طولانی از کاراکترها) باید کپی شده و به صورت کاملاً امن (مثلاً حضوری یا از طریق یک کانال ارتباطی امن دیگر) با طرف مقابل به اشتراک گذاشته شود.
    *   سپس هر دو کاربر باید این کلید جدید را در فایل `crypto.py` خود، مقدار متغیر `PRE_SHARED_KEY` را با آن جایگزین کرده و برنامه را مجدداً راه‌اندازی کنند. **کلید باید دقیقاً یکسان باشد. هنگام ویرایش فایل `crypto.py`، کلید جدید باید به صورت یک رشته بایتی پایتون وارد شود، یعنی `PRE_SHARED_KEY = b'YOUR_KEY_AS_A_STRING_HERE'` (دقت کنید به `b` قبل از کوتیشن‌ها).**

4.  **ارسال پیام:**
    پس از راه‌اندازی و اطمینان از یکسان بودن کلید، برای ارسال پیام، از فرمت زیر استفاده کنید و Enter را بزنید:
    `<recipient_ip>:<recipient_port> Your message here`
    مثال:
    `127.0.0.1:12346 سلام، این یک پیام تست است!`

5.  **دریافت پیام:**
    پیام‌های دریافتی به صورت خودکار در کنسول شما نمایش داده می‌شوند. ابتدا پیام رمزنگاری شده و سپس متن رمزگشایی شده (اگر کلید صحیح باشد) نمایش داده می‌شود.

6.  **خروج از برنامه:**
    برای خروج از برنامه، `exit` را تایپ کنید و Enter را بزنید یا از `Ctrl+C` استفاده کنید.

## نکات امنیتی و محدودیت‌ها

*   **امنیت کلید:** امنیت کل ارتباط به امنیت و یکسان بودن `PRE_SHARED_KEY` بستگی دارد. این کلید باید به صورت کاملاً امن بین کاربران به اشتراک گذاشته شود. این نسخه ساده، مکانیزم تبادل کلید امن خودکار (مانند Diffie-Hellman) را پیاده‌سازی نکرده است.
*   **آشکار بودن IP:** در ارتباطات P2P مستقیم، آدرس IP شما برای طرف مقابل قابل مشاهده خواهد بود. برای ناشناس ماندن بیشتر IP، باید از ابزارهایی مانند VPN یا Tor استفاده کنید (که خارج از محدوده این پروژه است).
*   **پروتکل UDP:** این برنامه از UDP برای ارسال پیام استفاده می‌کند که سریع است اما تحویل پیام را تضمین نمی‌کند و ترتیب پیام‌ها نیز ممکن است حفظ نشود. برای قابلیت اطمینان بیشتر، می‌توان از TCP استفاده کرد (که پیچیدگی بیشتری دارد).
*   **فایروال/NAT Traversal:** برای برقراری ارتباط در شبکه‌های مختلف (خارج از LAN یکسان)، ممکن است نیاز به تنظیم پورت فورواردینگ روی روتر یا استفاده از تکنیک‌های NAT traversal (مانند STUN/TURN) باشد که در این پروژه پیاده‌سازی نشده‌اند. این برنامه به احتمال زیاد فقط در شبکه محلی (LAN) یا در صورتی که یکی از طرفین دارای IP عمومی مستقیم باشد، به سادگی کار خواهد کرد.

## توسعه آینده (ایده‌ها)

*   پیاده‌سازی مکانیزم تبادل کلید امن (مانند Diffie-Hellman).
*   گزینه‌ای برای استفاده از TCP برای ارتباطات قابل اعتمادتر.
*   پشتیبانی از کشف همتا در شبکه محلی (LAN discovery با استفاده از broadcast/multicast).
*   رابط کاربری گرافیکی (GUI) با استفاده از کتابخانه‌هایی مانند Tkinter، PyQt یا Kivy.
*   ذخیره تاریخچه چت (به صورت رمزنگاری شده و محلی با اجازه کاربر).
*   پشتیبانی از ارسال فایل‌های کوچک.
*   بهبود مدیریت خطا و بازخورد به کاربر.

---
این یک پروژه اولیه و آموزشی برای نمایش مفهوم پیام‌رسان P2P ناشناس است. با در نظر گرفتن محدودیت‌های امنیتی و عملکردی ذکر شده، از آن استفاده کنید.